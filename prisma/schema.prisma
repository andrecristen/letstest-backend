generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id             Int             @id @default(autoincrement())
  email          String          @unique
  name           String
  password       String
  bio            String?
  access         Int
  involvements   Involvement[]
  projects       Project[]
  testExecutions TestExecution[]
  habilities     Hability[]
  devices        Device[]
  reports        Report[]
  notifications  NotificationRecipient[]
}

model Project {
  id            Int            @id @default(autoincrement())
  name          String
  description   String
  visibility    Int
  situation     Int
  dueDate       DateTime?
  creatorId     Int
  creator       User           @relation(fields: [creatorId], references: [id])
  environments  Environment[]
  involvements  Involvement[]
  testCases     TestCase[]
  templates     Template[]
  tags          Tag[]
  tagValues     TagValue[]
  testScenarios TestScenario[]
  notificationSettings NotificationSettings?
}

model TestScenario {
  id        Int        @id @default(autoincrement())
  data      Json
  name      String
  projectId Int
  project   Project    @relation(fields: [projectId], references: [id])
  testCases TestCase[]
}

model TestCase {
  id             Int             @id @default(autoincrement())
  data           Json
  name           String
  testScenarioId Int?
  projectId      Int
  environmentId  Int?
  dueDate        DateTime?
  testScenario   TestScenario?   @relation(fields: [testScenarioId], references: [id])
  project        Project         @relation(fields: [projectId], references: [id])
  environment    Environment?    @relation(fields: [environmentId], references: [id])
  testExecutions TestExecution[]
}

model Environment {
  id          Int        @id @default(autoincrement())
  name        String
  description String
  situation   Int
  projectId   Int
  project     Project    @relation(fields: [projectId], references: [id])
  testCases   TestCase[]
}

model Involvement {
  id        Int     @id @default(autoincrement())
  situation Int
  type      Int
  userId    Int
  projectId Int
  project   Project @relation(fields: [projectId], references: [id])
  user      User    @relation(fields: [userId], references: [id])
}

model Template {
  id          Int      @id @default(autoincrement())
  name        String
  description String
  data        Json
  type        Int
  projectId   Int?
  project     Project? @relation(fields: [projectId], references: [id])
}

model File {
  id     Int    @id @default(autoincrement())
  name   String
  bucket String
}

model TestExecution {
  id         Int       @id @default(autoincrement())
  data       Json
  reported   DateTime
  testTime   Int
  testCaseId Int
  userId     Int
  deviceId   Int?
  testCase   TestCase? @relation(fields: [testCaseId], references: [id])
  user       User?     @relation(fields: [userId], references: [id])
  device     Device?   @relation(fields: [deviceId], references: [id])
  reports    Report[]
}

model Hability {
  id     Int    @id @default(autoincrement())
  type   Int
  value  String
  userId Int
  user   User?  @relation(fields: [userId], references: [id])
}

model Device {
  id             Int             @id @default(autoincrement())
  type           Int
  brand          String
  model          String
  system         String
  userId         Int
  user           User?           @relation(fields: [userId], references: [id])
  testExecutions TestExecution[]
}

model Report {
  id              Int            @id @default(autoincrement())
  type            Int
  score           Int
  commentary      String
  testExecutionId Int
  userId          Int
  testExecution   TestExecution? @relation(fields: [testExecutionId], references: [id])
  user            User?          @relation(fields: [userId], references: [id])
}

model Notification {
  id         Int                     @id @default(autoincrement())
  type       Int
  title      String
  message    String
  metadata   Json?
  projectId  Int?
  createdAt  DateTime                @default(now())
  recipients NotificationRecipient[]
}

model NotificationRecipient {
  id              Int           @id @default(autoincrement())
  userId          Int
  notificationId  Int
  readAt          DateTime?
  emailSentAt     DateTime?
  emailError      String?
  user            User          @relation(fields: [userId], references: [id])
  notification    Notification  @relation(fields: [notificationId], references: [id])

  @@unique([userId, notificationId])
}

model NotificationSettings {
  id                      Int      @id @default(autoincrement())
  projectId               Int      @unique
  enableExecutionRejected Boolean  @default(true)
  enableInviteAccepted    Boolean  @default(true)
  enableDeadlineExceeded  Boolean  @default(true)
  enableDeadlineWarning   Boolean  @default(false)
  deadlineWarningDays     Int      @default(0)
  notifyEmail             Boolean  @default(true)
  notifyInApp             Boolean  @default(true)
  project                 Project  @relation(fields: [projectId], references: [id])
}

model Tag {
  id         Int        @id @default(autoincrement())
  name       String
  situation  Int
  commentary String?
  projectId  Int?
  project    Project?   @relation(fields: [projectId], references: [id])
  tagValues  TagValue[]
}

model TagValue {
  id         Int      @id @default(autoincrement())
  name       String
  situation  Int
  commentary String?
  data       Json?
  projectId  Int?
  tagId      Int
  project    Project? @relation(fields: [projectId], references: [id])
  tag        Tag      @relation(fields: [tagId], references: [id])
}
